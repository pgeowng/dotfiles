#!/bin/sh

case $BLOCK_BUTTON in
  4) xbacklight -inc 10 ;;
  5) xbacklight -dec 10 ;;
  6) "$TERMINAL" -e "$EDITOR" "$0"
esac

count="$(ls /sys/class/power_supply | grep "BAT*" | wc -w)"

[ "$count" = "0" ] && exit 0

for battery in /sys/class/power_supply/BAT?*; do
  [ -n "${capacity+x}" ] && printf " "

  case "$(cat "$battery/status")" in
    "Full") status="⚡" ;;
    "Discharging") status="🔋" ;;
    "Charging") status="🔌" ;;
    "Not charging") status="🛑" ;;
    "Unknown") status="♻️" ;;
  esac


  capacity=$(cat "$battery/capacity")

  msg_b="バッテリー残量が"
  msg_a="％未満です。\nデバイスを充電してください。"
  path="/tmp/$(echo -n "$battery" | tr '/' '_')_$capacity"

  [ "$status" = "🔋" ] && [ "$capacity" -le 25 ] && warn="❗"

  if [ "$status" = "🔋" ]; then
    if [ "$capacity" -eq 100 ] || [ "$capacity" -eq 10 ] || [ "$capacity" -eq 5 ] ; then
      notify-send "バッテリー 🔋" "$msg_b$capacity$msg_a"
    fi
  fi


  printf "%s%d%s" "$status" "$capacity" "$warn"; unset warn

done && exit 0
