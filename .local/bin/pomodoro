#!/bin/sh

log=$XDG_DATA_HOME/atl/log

pkill -RTMIN+15 dwmblocks

last=$(tail -n 1 "$log")
echo "$last"
if [ -n "$last" ]; then
  status=${last%%,*}
  prev_act=${last##*,}
  if [ "$status" = "start" ] ; then
     reset="\nreset"
  fi
fi

new_act=$( printf "30\\ntomato\\nshort\\nlong$reset" | dmenu -i -p "time:")
now=$(date "+%s")

case $new_act in
  tomato) echo "start,$now,time25" >> "$log" ;;
  30) echo "start,$now,time30" >> "$log" ;;
  short) echo "start,$now,time5" >> "$log" ;;
  long) echo "start,$now,time15" >> "$log" ;;
  reset) echo "end,$now,$prev_act" >> "$log" ;;
esac

pkill -RTMIN+15 dwmblocks
